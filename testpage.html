<!DOCTYPE html>
<html>
<head>
	<title>Test Page</title>
	<link rel="manifest" href="/manifest.json" />
	<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async=""></script>
	<script>
  	var OneSignal = window.OneSignal || [];
  	OneSignal.push(function() {
    	OneSignal.init({
      	appId: "3beb3078-e0f1-4629-af17-fde833b9f716",
    	});
    	OneSignal.showSlidedownPrompt();
  	});
	</script>
</head>
<body>
  <!-- Tag upon 3rd visit -->

  <!-- data-cfasync: Ignore CloudFlare's Rocket Loader, which may impact the triggering of the DOMContentLoaded event (see: https://goo.gl/CvZewv) -->
  <script data-cfasync="false">
  window.OneSignal = window.OneSignal || [];
  var numVisitsTrigger = 3; /* Number of page visits before prompting user */
  
  /* Why use .push? See: http://stackoverflow.com/a/38466780/555547 */
  window.OneSignal.push(function() {
    var numVisits = new Number(localStorage['numVisitsTrigger'] || 0);
    numVisits += 1;
    localStorage['numVisitsTrigger'] = numVisits;
    if (numVisits >= numVisitsTrigger) {
      tagUserWithPageTopic("key", "value");
    }
  });
  
  function tagUserWithPageTopic(key, value) {
    /* Want to trigger different permission messages? See: https://documentation.onesignal.com/docs/permission-requests#section-onesignal-permission-messages */
    window.OneSignal.isPushNotificationsEnabled(function(isEnabled) {
      console.log("isEnabled: ", isEnabled);
      if (isEnabled) {        
        window.OneSignal.sendTag(key, value).then(function(tagsSent) {
        // Callback called when tags have finished sending
        console.log('tagsSent: ', tagsSent);
        });  
      }
    });
  }
  </script>
  
  <!-- END TAG 3rd visit -->
  <!-- Send push upon subscribe
	<script>
			OneSignal.push(function() {
  			// Occurs when the user's subscription changes to a new value.
  			OneSignal.on('subscriptionChange', function (isSubscribed) {
    			console.log("The user's subscription state is now:", isSubscribed);
          OneSignal.getUserId(function(id) {
            console.log(id);
            if (isSubscribed === true) {
              var xhttp = new XMLHttpRequest();
              xhttp.open("POST", "https://onesignal.com/api/v1/notifications", true);
              xhttp.setRequestHeader("Content-type", "application/json");
              xhttp.setRequestHeader("Access-Control-Allow-Origin","*");
              xhttp.send({
                "app_id":"3beb3078-e0f1-4629-af17-fde833b9f716",
                "contents": {"en": "New Subscriber"},
                "include_player_ids":[id]
              });
            }
          })
  			});
			});
	</script>
  -->
</body>
</html>